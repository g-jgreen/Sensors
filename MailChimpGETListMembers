{
    "name": "MailChimpGETListMembers",
    "version": "1.0.0",
    "type": "sensor",
    "script": "var APIKey = options.requiredProperties.APIKey || options.globalSettings.MAILCHIMP_APIKEY;\nif (__.isEmpty(APIKey)) \n    send(new Error(\"Please specify APIKey.\"));\nvar dc = options.requiredProperties.datacenter || options.globalSettings.MAILCHIMP_DATACENTER;\nif (__.isEmpty(dc)) \n    send(new Error(\"Please specify datacenter.\"));\n\nvar list_id;    \ntry {\n    list_id = waylayUtil.getRawData(options, options.requiredProperties.list_id);\n} catch (err) {\n    list_id = options.requiredProperties.list_id;\n}\nif (__.isEmpty(list_id)) \n    send(new Error(\"Please specify list_id.\"));\n    \nvar url = 'https://' + dc + '.api.mailchimp.com/3.0/lists/' + list_id + '/members?apikey=' + APIKey;\n\ntry {\n    request({\n            'uri' : url\n        }, function(err, response, body){\n            if (!err && response.statusCode == 200) {\n                try{\n                    var data = JSON.parse(body);\n                    if (__.isEmpty(data.members)) { //if no lists are retrieved\n                        value = {\n                            observerdState : 'Not Found',\n                            rawData : data\n                        };\n                    } else { \n                        value = {\n                            observerdState : 'Found',\n                            rawData : {\n                                members : data.members,\n                                total_items : data.total_items\n                            }\n                        };\n                    }\n                \n               send(null, value);\n                    \n                } catch(err){\n                    send(new Error(err));\n                }\n\n            } else {\n                console.log(response);\n                send(new Error(err));\n            }\n    });    \n} catch(err){\n    send(new Error(err));\n}",
    "metadata": {
        "author": "Dan Dan",
        "category": "Social",
        "description": "retrieves the first 10 members for a specific list.. \n<br><br>\n<b>States</b>\n<ul>\n<li>Found: at least one member is retrieved</li>\n<li>Not Found</li>\n</ul><br>\n\n<b>Properties</b>\n<ul>\n<li>APIKey: found under your MailChimp Account > Extra > API Keys.</li>\n<li>datacenter: the last part of your APIKey (e.g. abcd...-us10, your datacenter is us10)</li>\n<li>list_id: list_id rawData from the getSubscribersList sensor</li>\n</ul><br>\n\n<b>Raw Data</b>\n<ul>\n<li>members: array of members objects (subscribed, unsubscribed, etc)</li>\n<li>total_items: number of members</li>\n</ul><br><br>\n\nSchema: https://us9.api.mailchimp.com/schema/3.0/Lists/Members/Collection.json",
        "documentationURL": "http://kb.mailchimp.com/api/resources/lists/members/lists-members-collection",
        "iconURL": "http://static.mailchimp.com/web/features/icon-mailchimp-mobile.png",
        "supportedStates": [
            "Found",
            "Not Found"
        ],
        "requiredProperties": [
            "APIKey",
            "datacenter",
            "list_id"
        ],
        "requiredRawData": [],
        "rawData": [
            {
                "parameter": "members",
                "dataType": "string"
            },
            {
                "parameter": "total_items",
                "dataType": "double"
            }
        ]
    }
}