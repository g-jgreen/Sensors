{
    "name": "FoursquareIsHereNow",
    "version": "0.0.5",
    "type": "sensor",
    "script": "var venue_id = waylayUtil.evaluateData(options, options.requiredProperties.venue_id);\nif (venue_id === undefined) {\n    send(new Error(\"Please specify venue ID.\"));\n}\n\nvar foursquare_client_id = options.requiredProperties.foursquare_client_id;\nvar foursquare_client_secret = options.requiredProperties.foursquare_client_secret;\nif (foursquare_client_id === undefined || foursquare_client_secret === undefined) {\n    send(new Error(\"Please enter BOTH foursquare_client_id AND foursquare_client_secret found under your foursquare application.\"));\n}\n\nvar isHereNow_threshold = waylayUtil.evaluateData(options, options.requiredProperties.isHereNow_threshold);\nvar isHereNow_range = waylayUtil.evaluateData(options, options.requiredProperties.isHereNow_range);\nif (isHereNow_threshold === undefined || isHereNow_range === undefined) {\n    send(new Error(\"Please enter an integer for threshold and range.\"));\n}\n\ntry {   \n    var url = 'https://api.foursquare.com/v2/venues/' + venue_id\n    + \"?client_id=\" + foursquare_client_id\n    + \"&client_secret=\" + foursquare_client_secret\n    + \"&v=\" + \"20140805\"\n    ;\n   \n    request({\n            'uri': url//,\n            /*'method' : 'GET'\n            form : {\n                ll_or_near : ll_or_near_value,\n                'client_id' : foursquare_client_id,\n                'client_secret' : foursquare_client_secret,\n            }*/\n            \n        }, function(err, response, body){\n            \n            if (!err && response.statusCode == 200) {\n                var data = JSON.parse(body);\n                \n                var hereNowCount = data.response.venue.hereNow.count;\n                \n                if (hereNowCount > isHereNow_threshold + isHereNow_range) {\n                    state = \"Above\";\n                } else if (hereNowCount < isHereNow_threshold + isHereNow_range || hereNowCount > isHereNow_threshold - isHereNow_range) {\n                    state = \"In Range\";\n                } else {\n                    state = \"Below\";\n                }\n                \n                var value = {\n                    observedState : state,\n                    rawData : { \n                        venue : data.response.venue,\n                        venueName : data.response.venue.name,\n                        venueContact : data.response.venue.contact,\n                        hereNowCount : hereNowCount,\n                        stats_checkinsCount : data.response.venue.stats.checkinsCount,\n                        stats_usersCount : data.response.venue.stats.usersCount,\n                        stats_tipCount : data.response.venue.stats.tipCount\n                    }\n                };\n                send(null, value);\n            } else {\n                console.log(response);\n                send(new Error(response.statusCode));\n            }\n    });    \n} catch(err){\n    send(new Error(err));\n}",
    "metadata": {
        "author": "Dan Dan",
        "category": "Location",
        "description": "lets you compare the number of persons at your foursquare venue.<br>\n\n<b>States</b><br>\nDescribes if the number of 'hereNow' users at your venue is above, in range, or below the provided threshold and range numbers.\n<ul>\n<li>Above</li>\n<li>In Range</li>\n<li>Below</li>\n</ul><br>\n\n<b>Properties</b>\n<ul>\n<li>venue ID</li>\n<li>threshold</li>\n<li>range</li>\n<li>foursquare_client_id, foursquare_client_secret, required from your foursquare application in order to make the request to the foursquare server.</li>\n</ul><br>\n\n<b>Raw Data</b>\n<ul>\n<li>venue - information about the venue</li>\n<li>name of the venue</li>\n<i>non-guaranteed responses</i>\n<li>contact of the venue</li>\n<li>location of the venue</li>\n<li>verified : boolean</li>\n<li>hereNow - number of people at the venue now</li>\n<li>stats_checkinsCount - total checkins ever here</li>\n<li>stats_usersCount - total users who have ever checked in here</li>\n<li>stats_tipCount - number of tips here</li>\n</ul><br>\n\nNote: Query limit is 5000 / hr for each client.<br>",
        "documentationURL": "https://developer.foursquare.com/docs/venues/venues",
        "iconURL": "https://raw.githubusercontent.com/waylayio/documentation/master/icons/FoursquareIsHereNow.png",
        "supportedStates": [
            "Above",
            "In Range",
            "Below"
        ],
        "requiredProperties": [
            "venue_id",
            "foursquare_client_id",
            "foursquare_client_secret",
            "isHereNow_threshold",
            "isHereNow_range"
        ],
        "requiredRawData": [],
        "rawData": [
            {
                "parameter": "venue",
                "dataType": "string"
            },
            {
                "parameter": "venueName",
                "dataType": "string"
            },
            {
                "parameter": "venueContact",
                "dataType": "string"
            },
            {
                "parameter": "venueLocation",
                "dataType": "string"
            },
            {
                "parameter": "verified",
                "dataType": "boolean"
            },
            {
                "parameter": "hereNowCount",
                "dataType": "integer"
            },
            {
                "parameter": "stats_checkinsCount",
                "dataType": "integer"
            },
            {
                "parameter": "stats_usersCount",
                "dataType": "integer"
            },
            {
                "parameter": "stats_tipCount",
                "dataType": "integer"
            }
        ]
    }
}
