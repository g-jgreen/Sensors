{
    "name": "MailChimpGETSubscriberLists",
    "version": "1.0.3",
    "type": "sensor",
    "script": "var APIKey = options.requiredProperties.APIKey || options.globalSettings.MAILCHIMP_APIKEY;\nif (APIKey === undefined) \n    send(new Error(\"Please specify APIKey.\"));\nvar dc = options.requiredProperties.datacenter || options.globalSettings.MAILCHIMP_DATACENTER;\nif (dc === undefined) \n    send(new Error(\"Please specify datacenter.\"));\n    \nvar url = 'https://' + dc + '.api.mailchimp.com/3.0/lists/?apikey=' + APIKey;\n\ntry {\n    request({\n            'uri' : url\n        }, function(err, response, body){\n            if (!err && response.statusCode == 200) {\n                try{\n                    var data = JSON.parse(body);\n                    if (__.isEmpty(data.lists)) { //if no lists are retrieved\n                        value = {\n                            observerdState : 'Not Found',\n                            rawData : data\n                        };\n                    } else { \n                        value = {\n                            observerdState : 'Found',\n                            rawData : {\n                                lists : data.lists,\n                                total_items : data.total_items,\n                                firstList : data.lists[0],\n                                lastList : data.lists[data.lists.length-1],\n                                firstListId : data.lists[0].id,\n                                lastListId : data.lists[data.lists.length-1].id,\n                                firstListName : data.lists[0].name,\n                                lastListName : data.lists[data.lists.length-1].name\n                            }\n                        };\n                    }\n                \n               send(null, value);\n                    \n                } catch(err){\n                    send(new Error(err));\n                }\n\n            } else {\n                console.log(response);\n                send(new Error(err));\n            }\n    });    \n} catch(err){\n    send(new Error(err));\n}",
    "metadata": {
        "author": "Dan Dan",
        "category": "Social",
        "description": "retrieves the list of subsscriber lists you have on your MailChimp account. \n<br><br>\n<b>States</b>\n<ul>\n<li>Found: at least one list is retrieved</li>\n<li>Not Found</li>\n</ul><br>\n\n<b>Properties</b>\n<ul>\n<li>APIKey: found under your MailChimp Account > Extra > API Keys.</li>\n<li>datacenter: the last part of your APIKey (e.g. abcd...-us10, your datacenter is us10)</li>\n</ul><br>\n\n<b>Raw Data</b>\n<ul>\n<li>lists: array of lists</li>\n<li>total_items: number of lists</li>\n<li>firstList: first list object</li>\n<li>lastList: last list object</li>\n<li>firstListId: Id of the first list</li>\n<li>lastListId: Id of the last list</li>\n<li>firstListName: Name of the first list</li>\n<li>lastListName: Name of the last list</li>\n</ul><br><br>\n\nSchema: https://us9.api.mailchimp.com/schema/3.0/Lists/Collection.json<br>\n\nWorks with the GETListMembers sensor to GET members for a specific list.\nhttp://kb.mailchimp.com/api/resources/lists/members/lists-members-collection",
        "documentationURL": "http://kb.mailchimp.com/api/resources/lists/lists-collection",
        "iconURL": "http://static.mailchimp.com/web/features/icon-mailchimp-mobile.png",
        "supportedStates": [
            "Found",
            "Not Found"
        ],
        "requiredProperties": [
            "APIKey",
            "datacenter"
        ],
        "requiredRawData": [],
        "rawData": [
            {
                "parameter": "lists",
                "dataType": "string[]"
            },
            {
                "parameter": "firstListId",
                "dataType": "string"
            },
            {
                "parameter": "lastListId",
                "dataType": "string"
            },
            {
                "parameter": "total_items",
                "dataType": "integer"
            },
            {
                "parameter": "firstList",
                "dataType": "double"
            },
            {
                "parameter": "lastList",
                "dataType": "double"
            },
            {
                "parameter": "firstListName",
                "dataType": "double"
            },
            {
                "parameter": "lastListName",
                "dataType": "double"
            }
        ]
    }
}