{
    "name": "travelDurationBetweenTwoPoints",
    "version": "0.0.3",
    "type": "sensor",
    "script": "\nvar origin = waylayUtil.evaluateData(options, options.requiredProperties.origin);\nvar destination = waylayUtil.evaluateData(options, options.requiredProperties.destination);\nvar thresholdTimeSec = waylayUtil.evaluateData(options, options.requiredProperties.thresholdTimeSec);\n\nif(origin === undefined || destination === undefined){\n    send(new Error(\"You need to specify origin and destination\"));\n}\nif(thresholdTimeSec === undefined){\n    send(new Error(\"You need to thresholdTimeSec\"));\n}\n\nvar modeOfTransport = waylayUtil.evaluateData(options, options.requiredProperties.modeOfTransport) || 'driving';\nvar transportModes = ['driving', 'walking', 'bicycling', 'transit'];\n\nvar API_Key = options.requiredProperties.API_Key\n\n//if modeOfTransport is not one of the transportModes, it defaults to driving\nif (!__.contains(transportModes, modeOfTransport.toLowerCase())) {\n    send(new Error(\"wrong type selected, it should be one of \" + transportModes.join(\",\")));\n}\n\ntry{\n    var url = 'https://maps.googleapis.com/maps/api/directions/json';\n    url += \"?origin=\"+origin;\n    url += \"&destination=\"+destination;\n    url += \"&mode=\"+modeOfTransport;\n    \n    //if API_Key is given, concat the API_Key for google maps API for work users\n    if (!__.isEmpty(API_Key)) {\n        url += 'key=' + API_Key;\n    }\n    \n    request({\n            'uri': url,\n            /*method: 'GET',\n            form: {\n                origin: origin,\n                destination: destination,\n                mode: modeOfTransport\n            }*/\n        }, function(err, response, body){\n            \n            if (!err && response.statusCode == 200) {\n                var data = JSON.parse(body);\n                \n                var travelTimeSec = data.routes[0].legs[0].duration.value;\n                data.travelTimeSec = travelTimeSec;\n                var observedState = 'Above';\n                travelTimeSec < thresholdTimeSec ? observedState = 'Below' : 'Above';\n                \n                var value ={\n                    observedState : observedState,\n                    rawData : data\n                }\n               send(null, value);\n            } else {\n                console.log(response);\n                send(new Error(response.statusCode));\n            }\n    });    \n} catch(err){\n    send(new Error(err));\n}\n",
    "metadata": {
        "author": "Dan Dan",
        "category": "Smart City",
        "description": "I will return Above if the duration taken between \norigin and destination is higher than the threshold \ntime in seconds, and return Below if the duration taken\nis lower than the threshold. Driving is default setting for the mode of transport.\n<br>\nOrigin & destination may be specified as \ntext strings\n(e.g. \"Chicago, IL\" or \"Darwin, NT, Australia\") \nor as latitude/longitude coordinates.\n<br>\nWhen you calculate directions, you may specify the \ntransportation mode to use. By default, directions \nare calculated as driving directions. The following \ntravel modes are supported:\n<ul><li>\ndriving (default) indicates standard driving \ndirections using the road network.</li>\n<li>walking requests walking directions via \npedestrian paths & sidewalks.</li>\n<li>bicycling requests bicycling directions via \nbicycle paths & preferred streets.</li>\n<li>transit requests directions via public \ntransit routes.</li></ul><br>\nFor Google Maps API for Work users, you may\nenter your API Key in the API_Key field. Limits \nfor free users can be read <a href=\"https://developers.google.com/maps/documentation/directions/#Limits\">here</a><br>\nRaw data contains JSON resposne from Google Maps. <a href=\"https://developers.google.com/maps/documentation/directions/#sample-response\">Sample</a><br>\nOrigin, destination, modeOfTransport, and thresholdTimeSec are evaluated using waylayUtil.evaluateData",
        "documentationURL": "https://developers.google.com/maps/documentation/directions/",
        "iconURL": "https://raw.githubusercontent.com/waylayio/documentation/master/icons/google-maps-logo.jpg",
        "supportedStates": [
            "Above",
            "Below"
        ],
        "requiredProperties": [
            "origin",
            "destination",
            "modeOfTransport",
            "thresholdTimeSec",
            "API_Key"
        ],
        "requiredRawData": [],
        "rawData": [
            {
                "parameter": "routes",
                "dataType": "Object[]"
            },
            {
                "parameter": "status",
                "dataType": "double"
            },
            {
                "parameter": "travelTimeSec",
                "dataType": "double"
            }
        ]
    }
}
