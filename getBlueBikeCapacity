{
  "name": "getBlueBikeCapacity",
  "version": "0.0.4",
  "type": "sensor",
  "script": "var url = options.requiredProperties.url || \"http://vim.integr.io/blue-mobility/blue-bike-gent-sint-pieters.json\";\ntry{\n    request({\n        \"uri\": url\n    }, function(err, response, body){\n        if (!err && response && response.statusCode == 200) {\n            var data = JSON.parse(body);\n            var attributes = data.properties.attributes;\n            var capacityTotal = _.find(attributes, function(attribute) {return attribute.attributeName === 'CapacityTotal'});\n            var capacityInUse = _.find(attributes, function(attribute) {return attribute.attributeName === 'CapacityInUse'});\n            var capacityAvailable = _.find(attributes, function(attribute) {return attribute.attributeName === 'CapacityAvailable'});\n            var capacityInMaintenance = _.find(attributes, function(attribute) {return attribute.attributeName === 'CapacityInMaintenance'});\n            var state = \"Neutral\";\n            if(capacityAvailable.value < 5)\n                state = \"Bad\";\n            if(capacityAvailable.value > 10)\n                state = \"Good\";\n            var rawData = { \n                capacityTotal: capacityTotal.value,\n                capacityInUse: capacityInUse.value,\n                capacityAvailable: capacityAvailable.value,\n                capacityInMaintenance: capacityInMaintenance.value,\n                description : data.properties.description\n            }\n            send(null, {observedState: state, rawData: rawData});\n        } else {\n            console.log(response);\n            send(new Error(err));\n        }\n    });\n} catch(err){\n    send(new Error(err)); \n}\n\n",
  "metadata": {
    "author": "",
    "category": "VIM",
    "description": "Returns the capacity of blue bikes occupation\nInput is the URL of the blue bike JSON response\nThere are two available URL's today:\n<pre>\n<ul>\n<li>http://vim.integr.io/blue-mobility/blue-bike-gent-sint-pieters.json</li>\n<li>http://vim.integr.io/blue-mobility/blue-bike-gent-dampoort.json</li>\n</ul>\n</pre>",
    "iconURL": "https://static.waylay.io/plugs/icons/bluebike.png",
    "supportedStates": [
      "Good",
      "Neutral",
      "Bad"
    ],
    "requiredProperties": [
      "url"
    ],
    "requiredRawData": [],
    "rawData": [
      {
        "parameter": "capacityTotal",
        "dataType": "integer"
      },
      {
        "parameter": "capacityInUse",
        "dataType": "integer"
      },
      {
        "parameter": "capacityAvailable",
        "dataType": "integer"
      },
      {
        "parameter": "capacityInMaintenance",
        "dataType": "integer"
      },
      {
        "parameter": "description",
        "dataType": "string"
      }
    ]
  }
}
