{
  "name": "windDirectionSensor",
  "version": "0.0.1",
  "type": "sensor",
  "script": "var parameter = options.requiredProperties.parameter;\nvar username =  options.globalSettings.API_KEY;\nvar password = options.globalSettings.API_PASS;\nvar domain = options.requiredProperties.domain || options.globalSettings.waylay_domain ||\"app.waylay.io\";\nvar dataDomain = options.globalSettings.data_domain || \"https://data.waylay.io/\";\nvar resource = \"veselin@waylay.io@mobile-alerts.0B002FA7C3D3\" || options.requiredProperties.resource || waylayUtil.getResource(options) ;\nvar runtimeParam;\n\nvar sendResult = function(){\n    var value = {\n        observedState : \"NONE\",\n        rawData: {\n            parameter: runtimeParam\n        }\n    }\n    if(Math.abs(315 - runtimeParam) <= 22.5)\n        value.observedState = \"NW\";\n    else if(Math.abs(270 - runtimeParam) <= 22.5)\n        value.observedState = \"W\";\n    else if(Math.abs(225 - runtimeParam) <= 22.5)\n        value.observedState = \"SW\";\n    else if(Math.abs(180 - runtimeParam) <= 22.5)\n        value.observedState = \"S\";\n    else if(Math.abs(135 - runtimeParam) <= 22.5)\n        value.observedState = \"SE\";\n    else if(Math.abs(90 - runtimeParam) <= 22.5)\n        value.observedState = \"E\";\n    else if(Math.abs(45 - runtimeParam) <= 22.5)\n        value.observedState = \"NE\";\n    else if(Math.abs(0 - runtimeParam) <= 22.5)\n        value.observedState = \"N\";\n    send(null, value);\n}\n\ntry {\n    if(parameter === undefined){\n        send(new Error(\"missing properites\"))\n    } else {\n        runtimeParam = waylayUtil.getStreamData(options, parameter);\n        if(runtimeParam !== undefined){\n            console.log(\"runtime data : \" + runtimeParam);\n            sendResult();\n        } else{\n            if(domain !== undefined  && username !== undefined && password !== undefined && resource !== undefined)  {\n                var url = dataDomain + \"resources/\"+ resource +\"/current?domain=\"+domain;\n                var options = {\n                    url: url,\n                    method: 'GET',\n                    auth: {\n                        user: username,\n                        password: password\n                    }\n                };\n                request(options, function (error, response, body) {\n                  console.log(\"check the cloud cache\")\n                  if (!error && response.statusCode == 200) {\n                    console.log(body);\n                    var rawData = JSON.parse(body);\n                    console.log(rawData);\n                    runtimeParam = rawData[parameter];\n                    if(!isNaN(runtimeParam)){\n                        sendResult();\n                        } else {\n                            if(runtimeParam === undefined)\n                                send(new Error(\"Parameter \" +  parameter + \" not found\"));\n                            else\n                                send(new Error(\"Parameter \" +  runtimeParam + \" not a number\"));\n                        }\n                    } else {\n                        console.log(response);\n                        send(new Error(\"data not found\"));\n                    }\n                }); \n            } else{\n                 send(new Error(\"Missing properties\"));\n            }\n        }\n    }\n} catch(err){\n    send(new Error(err));   \n}",
  "metadata": {
    "author": "Veselin",
    "category": "Waylay",
    "description": "Range sensor that can be used either as a stream sensor or as a polling sensor.\nIn case of the polling, it tries to read the data from the waylaycache.\n\nInput paramters are:\n<ul>\n<li>parameter (runtime name)</li>\n<li>upperBound</li>\n<li>lowerBound</li>\n</ul>\n\n",
    "documentationURL": "",
    "iconURL": "https://dummyimage.com/160&text=windDirectionSensor",
    "supportedStates": [
      "In Range",
      "Below",
      "Above"
    ],
    "requiredProperties": [
      "parameter"
    ],
    "requiredRawData": [],
    "rawData": [
      {
        "parameter": "parameter",
        "dataType": "double"
      },
      {
        "parameter": "upperBound",
        "dataType": "double"
      },
      {
        "parameter": "lowerBound",
        "dataType": "double"
      }
    ]
  }
}
